<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="RH"/><link rel="canonical" href="https://herdzikrobert.com/posts/overflow_operators_2021_1_2"/><meta name="twitter:url" content="https://herdzikrobert.com/posts/overflow_operators_2021_1_2"/><meta name="og:url" content="https://herdzikrobert.com/posts/overflow_operators_2021_1_2"/><title>What is &amp;+ operator for, and why Int8(127) &amp;+ 1 is equal to -128 | RH</title><meta name="twitter:title" content="What is &amp;+ operator for, and why Int8(127) &amp;+ 1 is equal to -128 | RH"/><meta name="og:title" content="What is &amp;+ operator for, and why Int8(127) &amp;+ 1 is equal to -128 | RH"/><meta name="description" content="Let's lean over some less usual operators in Swift"/><meta name="twitter:description" content="Let's lean over some less usual operators in Swift"/><meta name="og:description" content="Let's lean over some less usual operators in Swift"/><meta name="twitter:card" content="summary_large_image"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to RH"/><meta name="twitter:image" content="https://herdzikrobert.com//Assets/Photos/knife.jpg"/><meta name="og:image" content="https://herdzikrobert.com//Assets/Photos/knife.jpg"/></head><head><link rel="stylesheet" href="/Base/all.css"/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-163377950-1"></script><script>                        window.dataLayer = window.dataLayer || [];
                        function gtag(){dataLayer.push(arguments);}
                        gtag('js', new Date());

                        gtag('config', 'UA-163377950-1');</script></head><body class="item-page"><header><nav><div><div class="align-left"><a class="nav-buttn-selected" href="/posts">Posts</a><a class="nav-buttn-disabled" href="/about_me">About_Me</a></div><div class="social-buttons-align-right"><a class="fab fa-twitter-square" href="https://twitter.com/roherdzik"></a><a class="fab fa-github-square" href="https://github.com/robertherdzik"></a><a class="fab fa-linkedin" href="https://www.linkedin.com/in/robert-herdzik-2b977b9a"></a><a class="fab fa-500px" href="https://500px.com/roherdzik2"></a><a class="fas fa-envelope-square" href="mailto:roherdzik2@gmail.com"></a></div></div></nav></header><div class="wrapper"><img class="item-img" src="/Assets/Photos/knife.jpg"/><article><div class="content"><h1>What is <code>&amp;+</code> operator for, and why Int8(127) &amp;+ 1 is equal to -128</h1><h2>Long story short</h2><p>Scrolling through Apple <a href="https://docs.swift.org/swift-book/LanguageGuide/AdvancedOperators.html">Advanced Swift Operators</a> documentation I encountered something 'interesting‚Äô. The case is that I have never used it, and neither see in the production code of the project to which I participated so far. I thought, let's play with this ‚Äòjust in case‚Äô.</p><p>My attention was caught by following operators:</p><ul><li><code>&amp;+</code> - Overflow addition</li><li><code>&amp;-</code> - Overflow subtraction</li><li><code>&amp;*</code> - Overflow multiplication</li></ul><p>All of them has been created to deal with <a href="https://en.wikipedia.org/wiki/Integer_overflow#:~:text=In%20computer%20programming%2C%20an%20integer,than%20the%20minimum%20representable%20value.">Integer overflow</a> scenarios in our codebase,</p><p>What is Integer Overflow you may ask... is situation where: "an arithmetic operation attempts to create a numeric value that is outside of the range that can be represented with a given number of digits ‚Äì either higher than the maximum or lower than the minimum representable value.", we are going to explain it using example later on üòé.</p><p>I know that is not a common case, but it is good to have at least an idea that some API for handling mentioned computation in Swift is waiting for us.</p><h2>YouTube already failed with <code>Integer overflow</code></h2><p>Researching quickly about the topic of Integer overflow, I found one funny story related to Youtube website, and how they fail with assuming that 'Int32' is going to be enough to store ‚Äòview count‚Äô for each video. Yep, they took the following assumption, and it was working for them for a long time, but suddenly crazy viral <a href="https://www.youtube.com/watch?v=9bZkp7q19f0">Psy‚Äôs ‚ÄúGangnam Style‚Äù</a> video came, and destroyed they ‚Äòview count‚Äô layout, because mentioned video exceeded value which is able to be stored by 'Int32' variable, mean that music video surpassed over 2,147,483,647 views. After admitting that they made a mistake, the view counter type has been switched to 'Int64' which can store enormous 9,223,372,036,854,775,807 (gosh‚Ä¶ that‚Äôs over 9 quintillion) views.</p><h2>Scenarios in which simple <code>+</code> operator is not enough</h2><p>As an example we can use 'Int8' (signed 8-bit integer) type, which can store values from -128 to 127.</p><p>Normally if we do simple calculation like:</p><pre><code>let a: Int8 = 127
let b: Int8 = 1
let sum = a + b // Compilation error üí•
</code></pre><p>We get a smart compilation error which says that: ‚ÄúArithmetic operation ‚Äò127 + 1‚Äô (on type ‚ÄòInt8‚Äô) results in an overflow‚Äù, that is great! Seems that we are covered‚Ä¶ unfortunately we compilation is going to help us only in that kind of static/obvious scenario, let's consider other scenarios in which compilation won‚Äôt help us:</p><pre><code>func makeValue() -&gt; Int8 { 1 }
    
let a: Int8 = 127
let b: Int8 = makeValue()
let sum = a + b // Runtime error üí•
</code></pre><p>That scenario is giving us "Thread 1: Swift runtime failure: arithmetic overflow‚Äù runtime error, plus beautiful app crash. üò™</p><h2>Overflow addition to the rescue!</h2><p>We can consider once again the first example but with usage of <code>&amp;+</code> operator.</p><pre><code>let a: Int8 = 127
let b: Int8 = 1
let sum = a &amp;+ b // Compilator is OK with this ü§ì 
</code></pre><p>As we can see, compilation went smoothly, but the result of the calculation is quite unexpected at the first glance, because after checking 'sum' constant value, we see -128, what the heck!</p><p>To understand better this operator, we can do manual 'Int8' addition with the deliberate overflow, bit by bit.</p><p>Taking our 127 number, which is the maximum positive value of 'Int8' type, where binary representation is: 0111 1111 , most significant bit (MSB) has 0 value (0 for positive, and 1 for negative numbers). And 'Int8(1)' binary representation is: 0000 0001. Knowing this lets do Overflow addition:</p><img src="/Assets/Photos/overflow_addition.jpg" alt="article-img-small"/><p>Ok! Everything is now clear, <code>&amp;+</code> operator in this calculation flipped to 1 our MSB bit, and in result we get a binary value of 1000 0000 which in decimal is represented by -128.</p><h2>Is there any easy way to react in Unit Tests on type Overflow cases?</h2><p>For creating Unit Tests which can check Type Overflows, we could use the 'addingReportingOverflow' method which as a result returns tuple of operation value and 'Bool' value which indicate whether operation has been finished with overflow or not.</p><pre><code>let result = Int8.max.addingReportingOverflow(10) 
</code></pre><p>'result' is an tuple, which has following values for presented scenario: <code>(partialValue -128, overflow true)</code></p><hr><h3>Resources</h3><ul><li><a href="https://www.youtube.com/watch?v=vA0Rl6Ne5C8">How Gangnam Style Broke Youtube View Counter?</a></li><li><a href="https://en.wikipedia.org/wiki/Integer_overflow">Integer overflow</a></li></ul><hr></div><span class="taged-container"><br/>Tagged with: </span><ul class="tag-list"><li class="code"><a href="/tags/swift">swift</a></li></ul></article></div></body></html>